"use strict";(self.webpackChunksinnammanyo_cn=self.webpackChunksinnammanyo_cn||[]).push([[5177],{45717:(e,n,t)=>{t.r(n),t.d(n,{Highlight:()=>s,assets:()=>i,contentTitle:()=>r,default:()=>d,frontMatter:()=>p,metadata:()=>o,toc:()=>c});var a=t(87462),l=(t(67294),t(3905));t(83989);const p={id:"opencv-install-gpu",title:"OpenCV \u5f00\u53d1\u73af\u5883\u914d\u7f6e",sidebar_label:"Install-GPU"},r=void 0,o={unversionedId:"cv/opencv/install/opencv-install-gpu",id:"cv/opencv/install/opencv-install-gpu",title:"OpenCV \u5f00\u53d1\u73af\u5883\u914d\u7f6e",description:"Name | Version |",source:"@site/docs/stack/cv/opencv/install/opencv-install-02.md",sourceDirName:"cv/opencv/install",slug:"/cv/opencv/install/opencv-install-gpu",permalink:"/stack/cv/opencv/install/opencv-install-gpu",draft:!1,editUrl:"https://github.com/rcxxx/sinnammanyo.cn/tree/master/docs/stack/cv/opencv/install/opencv-install-02.md",tags:[],version:"current",frontMatter:{id:"opencv-install-gpu",title:"OpenCV \u5f00\u53d1\u73af\u5883\u914d\u7f6e",sidebar_label:"Install-GPU"},sidebar:"\ud83d\udc40 CV && \ud83e\udde0 ML & DL",previous:{title:"Install-CPU",permalink:"/stack/cv/opencv/install/opencv-install-cpu"},next:{title:"Build Config",permalink:"/stack/cv/opencv/install/opencv-build-cfg"}},i={},c=[{value:"OpenCV",id:"opencv",level:2},{value:"\u4ece\u6e90\u7801\u7f16\u8bd1OpenCV - \u5f00\u542fGPU\u652f\u6301",id:"\u4ece\u6e90\u7801\u7f16\u8bd1opencv---\u5f00\u542fgpu\u652f\u6301",level:2},{value:"\u5b89\u88c5\u524d\u5148\u5b89\u88c5\u663e\u5361\u9a71\u52a8\u4ee5\u53caCUDA\u3001CUDNN",id:"\u5b89\u88c5\u524d\u5148\u5b89\u88c5\u663e\u5361\u9a71\u52a8\u4ee5\u53cacudacudnn",level:3},{value:"\u83b7\u53d6 <strong><code>OpenCV</code></strong> \u6e90\u7801",id:"\u83b7\u53d6-opencv-\u6e90\u7801",level:3},{value:"\u5b89\u88c5\u5404\u79cd\u4f9d\u8d56",id:"\u5b89\u88c5\u5404\u79cd\u4f9d\u8d56",level:3},{value:"\u7f16\u8bd1",id:"\u7f16\u8bd1",level:3},{value:"\u6d4b\u8bd5 opencv-python \u5b89\u88c5",id:"\u6d4b\u8bd5-opencv-python-\u5b89\u88c5",level:3},{value:"\u914d\u7f6e\u73af\u5883\u53d8\u91cf",id:"\u914d\u7f6e\u73af\u5883\u53d8\u91cf",level:3},{value:"\u6d4b\u8bd5\u5b89\u88c5",id:"\u6d4b\u8bd5\u5b89\u88c5",level:3},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:2}],s=e=>{let{children:n,color:t}=e;return(0,l.kt)("span",{style:{backgroundColor:t,borderRadius:"2px",color:"#fff",padding:"0.2rem"}},n)},u={toc:c,Highlight:s};function d(e){let{components:n,...t}=e;return(0,l.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Version"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u7cfb\u7edf\u7248\u672c"),(0,l.kt)("td",{parentName:"tr",align:"center"},"Ubuntu20.04LTS")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"OpenCV"),(0,l.kt)("td",{parentName:"tr",align:"center"},"4.7.0")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"CUDA"),(0,l.kt)("td",{parentName:"tr",align:"center"},"12.0")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"CUDNN"),(0,l.kt)("td",{parentName:"tr",align:"center"},"8.8.1")))),(0,l.kt)("h2",{id:"opencv"},"OpenCV"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://opencv.org/"},"OpenCV\u5b98\u7f51"))),(0,l.kt)("h2",{id:"\u4ece\u6e90\u7801\u7f16\u8bd1opencv---\u5f00\u542fgpu\u652f\u6301"},"\u4ece\u6e90\u7801\u7f16\u8bd1OpenCV - \u5f00\u542fGPU\u652f\u6301"),(0,l.kt)("h3",{id:"\u5b89\u88c5\u524d\u5148\u5b89\u88c5\u663e\u5361\u9a71\u52a8\u4ee5\u53cacudacudnn"},"\u5b89\u88c5\u524d\u5148\u5b89\u88c5\u663e\u5361\u9a71\u52a8\u4ee5\u53caCUDA\u3001CUDNN"),(0,l.kt)("p",null,"\u53ef\u4ee5\u53c2\u8003\u8fd9\u91cc\ud83d\udc49"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://developer.nvidia.com/cuda-12-0-0-download-archive"},"Nvidia GPU Computing Toolkit v12.0")),(0,l.kt)("li",{parentName:"ul"},"CUDNN")),(0,l.kt)("h3",{id:"\u83b7\u53d6-opencv-\u6e90\u7801"},"\u83b7\u53d6 ",(0,l.kt)("strong",{parentName:"h3"},(0,l.kt)("inlineCode",{parentName:"strong"},"OpenCV"))," \u6e90\u7801"),(0,l.kt)("p",null,"\u4ece\u5b98\u7f51\u4e0b\u8f7d\u538b\u7f29\u5305"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/opencv/opencv/releases/tag/4.7.0"},(0,l.kt)("strong",{parentName:"a"},(0,l.kt)("inlineCode",{parentName:"strong"},"opencv-4.7.0")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/opencv/opencv_contrib/releases/tag/4.7.0"},(0,l.kt)("strong",{parentName:"a"},(0,l.kt)("inlineCode",{parentName:"strong"},"opencv_contrib-4.7.0")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/opencv/opencv_extra/releases/tag/4.7.0"},(0,l.kt)("strong",{parentName:"a"},(0,l.kt)("inlineCode",{parentName:"strong"},"opencv_extra-4.7.0"))))),(0,l.kt)("p",null,"\u4e0b\u8f7d\u5b8c\u6210\u540e\u89e3\u538b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tar zxvf opencv-4.7.0.tar.gz ~/workspace/opencv/4.7.0/\ntar zxvf opencv_contrib-4.7.0.tar.gz ~/workspace/opencv/4.7.0/\ntar zxvf opencv_extra-4.7.0.tar.gz ~/workspace/opencv/4.7.0/\n")),(0,l.kt)("h3",{id:"\u5b89\u88c5\u5404\u79cd\u4f9d\u8d56"},"\u5b89\u88c5\u5404\u79cd\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt-get install \\\nbuild-essential \\\ncmake \\\ngit \\\nlibgtk2.0-dev \\\npkg-config \\\nlibavcodec-dev \\\nlibavformat-dev \\\nlibswscale-dev \\\nlibtbb2 \\\nlibtbb-dev \\\nlibjpeg-dev \\\nlibpng-dev \\\nlibtiff-dev \\\nlibdc1394-22 \\\nlibglew-dev \\\nzlib1g-dev \\\nlibavutil-dev \\\nlibpostproc-dev \\\nlibeigen3-dev \\\nlibopenexr-dev \\\nlibwebp-dev \\\nlibgtk-3-dev \\\nqtbase5-dev \\\nlibgstreamer1.0-dev \\\nlibgstreamer-plugins-base1.0-dev\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"strong"},"libjasper-dev")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'sudo add-apt-repository "deb http://security.ubuntu.com/ubuntu xenial-security main"\nsudo apt update\nsudo apt install libjasper-dev\n')),(0,l.kt)("h3",{id:"\u7f16\u8bd1"},"\u7f16\u8bd1"),(0,l.kt)("p",null,"\u65b0\u5efa ",(0,l.kt)("inlineCode",{parentName:"p"},"build/")," \u76ee\u5f55\u5b58\u653e\u7f16\u8bd1\u751f\u6210\u7684\u6587\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~/workspace/opencv/4.7.0/;mkdir build;cd build\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},(0,l.kt)(s,{color:"#FFA500",mdxType:"Highlight"},"[\u53ef\u9009]"))," \u914d\u7f6e\u5e76\u751f\u6210 ",(0,l.kt)("inlineCode",{parentName:"li"},"makefile")," \u8fc7\u7a0b\u4e2d\u4f1a\u4e0b\u8f7d\u4e00\u4e9b\u4f9d\u8d56\u5185\u5bb9\uff0c\u5efa\u8bae\u5f00\u542f\u7f51\u7edc\u4ee3\u7406")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"export http_proxy=socks5://127.0.0.1:7890;export https_proxy=socks5://127.0.0.1:7890;export all_proxy=socks5://127.0.0.1:7890\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},(0,l.kt)(s,{color:"#FFA500",mdxType:"Highlight"},"[\u53ef\u9009]"))," \u5982\u679c\u4f60\u7684 Python \u73af\u5883\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"Anaconda")," \u6216\u8005\u662f\u5176\u4ed6\u7684 python \u73af\u5883\u7ba1\u7406\u5e94\u7528\uff0c\u8bb0\u5f97\u542f\u7528\u4f60\u7684\u865a\u62df\u73af\u5883\uff0c\u8fd9\u91cc\u4f1a\u914d\u7f6e python \u5305\u7684\u8def\u5f84\uff0c\u7f16\u8bd1\u652f\u6301 CUDA \u7684 opencv-python \u7248\u672c")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"conda activate {env-name}\n")),(0,l.kt)("p",null,"\u914d\u7f6e ",(0,l.kt)("inlineCode",{parentName:"p"},"cmake")," \u53c2\u6570\uff0c\u4fee\u6539 ",(0,l.kt)("inlineCode",{parentName:"p"},"opencv_extra")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"opencv_contrib")," \u7684\u8def\u5f84"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'cmake -DCMAKE_BUILD_TYPE=Release \\\n    -DCMAKE_INSTALL_PREFIX=/usr/local \\\n    -DOPENCV_GENERATE_PKGCONFIG=YES \\\n    -DWITH_QT=ON \\\n    -DWITH_OPENGL=ON \\\n    -DWITH_TBB=ON \\\n    -DWITH_OPENCL=ON \\\n    -DWITH_FFMPEG=ON \\\n    -DWITH_CUDA=ON \\\n    -DOPENCV_DNN_CUDA=ON \\\n    -DCUDA_ARCH_BIN=5.0,5.2,6.0,6.1,7.0,7.5,8.0,8.6,8.9,9.0 \\\n    -DENABLE_FAST_MATH=ON \\\n    -DCUDA_FAST_MATH=ON \\\n    -DWITH_CUBLAS=ON \\\n    -DWITH_GTK=ON \\\n    -DCUDA_TOOLKIT_ROOT_DIR=/usr/local/cuda \\\n    -DCUDA_ARCH_PTX="" \\\n    -DBUILD_WITH_DEBUG_INFO=ON \\\n    -DBUILD_opencv_python3=ON \\\n    -DPYTHON3_NUMPY_INCLUDE_DIRS=$(python3 -c "import numpy; print(numpy.get_include())") \\\n    -DPYTHON3_PACKAGES_PATH=$(python3 -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())") \\\n    -DPYTHON3_LIBRARY=$(python3 -c "from distutils.sysconfig import get_config_var;from os.path import dirname,join ; print(join(dirname(get_config_var(\'LIBPC\')),get_config_var(\'LDLIBRARY\')))") \\\n    -DINSTALL_TESTS=ON \\\n    -DOPENCV_TEST_DATA_PATH=../opencv_extra-4.7.0/testdata \\\n    -DOPENCV_EXTRA_MODULES_PATH=../opencv_contrib-4.7.0/modules \\\n    ../opencv-4.7.0\n')),(0,l.kt)("p",null,"\u914d\u7f6e\u5b8c\u6210\u540e\u7684\u90e8\u5206\u7ec8\u7aef\u8f93\u51fa\u5185\u5bb9"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"--   NVIDIA CUDA:                   YES (ver 12.0, CUFFT CUBLAS FAST_MATH)\n--     NVIDIA GPU arch:             50 52 60 61 70 75 80 86 89 90\n--     NVIDIA PTX archs:\n-- \n--   cuDNN:                         YES (ver 8.8.1)\n-- \n--   OpenCL:                        YES (no extra features)\n--     Include path:                ~/workspace/opencv/4.7.0/opencv-4.7.0/3rdparty/include/opencl/1.2\n--     Link libraries:              Dynamic load\n-- \n--   Python 3:\n--     Interpreter:                 ~/anaconda3/envs/opencv-cuda/bin/python3 (ver 3.8.16)\n--     Libraries:                   ~/anaconda3/envs/opencv-cuda/lib/libpython3.8.so (ver 3.8.16)\n--     numpy:                       ~/anaconda3/envs/opencv-cuda/lib/python3.8/site-packages/numpy/core/include (ver 1.24.2)\n--     install path:                ~/anaconda3/envs/opencv-cuda/lib/python3.8/site-packages/cv2/python-3.8\n-- \n--   Python (for build):            ~/anaconda3/envs/opencv-cuda/bin/python3\n-- \n--   Java:                          \n--     ant:                         NO\n--     JNI:                         NO\n--     Java wrappers:               NO\n--     Java tests:                  NO\n-- \n--   Install to:                    /usr/local\n-- -----------------------------------------------------------------\n-- \n-- Configuring done\n-- Generating done\n")),(0,l.kt)("p",null,"\u751f\u6210\u5b8c\u4e4b\u540e\u5f00\u59cb\u7f16\u8bd1"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"NUM_CPU=$(nproc)\nmake -j$(($NUM_CPU - 1))\n")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u8fd9\u91cc\u7f16\u8bd1\u65f6\u95f4\u66f4\u4e45\uff0c\u4f60\u53ef\u4ee5\u53eb\u51e0\u4e2a\u670b\u53cb\u4e00\u8d77\u559d\u8336 (= =!)")),(0,l.kt)("p",null,"\u7b49\u5f85\u7f16\u8bd1\u5b8c\u6210\u540e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"sudo make install\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5c06\u7f16\u8bd1\u597d\u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},".so")," \u6587\u4ef6\u4ee5\u53ca\u5934\u6587\u4ef6\u5b89\u88c5\u5230 ",(0,l.kt)("inlineCode",{parentName:"li"},"/usr/local")," \u76ee\u5f55\u4e0b")),(0,l.kt)("h3",{id:"\u6d4b\u8bd5-opencv-python-\u5b89\u88c5"},"\u6d4b\u8bd5 opencv-python \u5b89\u88c5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'python -c "import cv2;print(cv2.getBuildInformation())"\n')),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://pictures-1304295136.cos.ap-guangzhou.myqcloud.com/screenshot/ubuntu/opencv/cv2test.png",alt:null})),(0,l.kt)("p",null,"python \u5305\u5b89\u88c5\u6210\u529f"),(0,l.kt)("h3",{id:"\u914d\u7f6e\u73af\u5883\u53d8\u91cf"},"\u914d\u7f6e\u73af\u5883\u53d8\u91cf"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("inlineCode",{parentName:"strong"},"sudo gedit /etc/ld.so.conf.d/opencv.conf"))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6253\u5f00 ",(0,l.kt)("inlineCode",{parentName:"li"},"opencv.conf")," \u5728\u5176\u4e2d\u6dfb\u52a0 ",(0,l.kt)("inlineCode",{parentName:"li"},"/usr/local/lib"))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("inlineCode",{parentName:"strong"},"sudo gedit /etc/bash.bashrc"))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6253\u5f00 ",(0,l.kt)("inlineCode",{parentName:"li"},"bash.bashrc")," \u5728\u6700\u540e\u9762\u6dfb\u52a0")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig \nexport PKG_CONFIG_PATH\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"strong"},"sudo ldconfig"))," \u4f7f\u914d\u7f6e\u751f\u6548")),(0,l.kt)("h3",{id:"\u6d4b\u8bd5\u5b89\u88c5"},"\u6d4b\u8bd5\u5b89\u88c5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"pkg-config --libs opencv4\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://pictures-1304295136.cos.ap-guangzhou.myqcloud.com/screenshot/ubuntu/opencv/pkg-config%20--libs-opencv4.png",alt:null})),(0,l.kt)("p",null,"\u5b89\u88c5\u5b8c\u6210"),(0,l.kt)("h2",{id:"\u53c2\u8003"},"\u53c2\u8003"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},(0,l.kt)("a",{parentName:"strong",href:"https://docs.opencv.org/4.4.0/d6/d15/tutorial_building_tegra_cuda.html"},"Building OpenCV for Tegra with CUDA"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},(0,l.kt)("a",{parentName:"strong",href:"https://zhuanlan.zhihu.com/p/392751819"},"\u5728 Linux \u7cfb\u7edf\u4e2d\u7f16\u8bd1\u5b89\u88c5 OpenCV")))))}d.isMDXComponent=!0}}]);