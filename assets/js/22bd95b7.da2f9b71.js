"use strict";(self.webpackChunksinnammanyo_cn=self.webpackChunksinnammanyo_cn||[]).push([[4557],{4889:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>k,frontMatter:()=>s,metadata:()=>p,toc:()=>i});var r=n(87462),a=(n(67294),n(3905));n(83989);const s={id:"esp32-demo-freertos-event_group",title:"",sidebar_label:"freertos event_group"},o=void 0,p={unversionedId:"devices/esp32/freertos/esp32-demo-freertos-event_group",id:"devices/esp32/freertos/esp32-demo-freertos-event_group",title:"",description:"ESP32 Demo FreeRTOS Event Group",source:"@site/docs/stack/devices/esp32/freertos/esp32-demo-freertos-event_group.md",sourceDirName:"devices/esp32/freertos",slug:"/devices/esp32/freertos/esp32-demo-freertos-event_group",permalink:"/stack/devices/esp32/freertos/esp32-demo-freertos-event_group",draft:!1,editUrl:"https://github.com/rcxxx/sinnammanyo.cn/tree/master/docs/stack/devices/esp32/freertos/esp32-demo-freertos-event_group.md",tags:[],version:"current",frontMatter:{id:"esp32-demo-freertos-event_group",title:"",sidebar_label:"freertos event_group"},sidebar:"\ud83d\udda5\ufe0fdevices&system",previous:{title:"freertos_task_list",permalink:"/stack/devices/esp32/freertos/esp32-demo-freertos_task_list"},next:{title:"Demo Wifi",permalink:"/stack/devices/esp32/wifi/esp32-demo-wifi"}},l={},i=[{value:"ESP32 Demo FreeRTOS Event Group",id:"esp32-demo-freertos-event-group",level:2},{value:"Event bits / Event groups",id:"event-bits--event-groups",level:3},{value:"API",id:"api",level:3},{value:"xEventGroupCreate()",id:"xeventgroupcreate",level:4},{value:"xEventGroupWaitBits()",id:"xeventgroupwaitbits",level:4},{value:"xEventGroupSetBits()",id:"xeventgroupsetbits",level:4},{value:"\u793a\u4f8b\u4ee3\u7801",id:"\u793a\u4f8b\u4ee3\u7801",level:2},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:2}],u={toc:i};function k(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"esp32-demo-freertos-event-group"},"ESP32 Demo FreeRTOS Event Group"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"name"),(0,a.kt)("th",{parentName:"tr",align:null},"version"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"System"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},(0,a.kt)("a",{parentName:"strong",href:"https://releases.ubuntu.com/20.04/"},"Ubuntu 20.04")))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"CMake"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},(0,a.kt)("a",{parentName:"strong",href:"https://cmake.org/"},"3.10"))," \u2265")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"ESP-IDF"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},(0,a.kt)("a",{parentName:"strong",href:"https://github.com/espressif/esp-idf"},"master--v5.1")))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"ESP-IDF Programming GuideLogo"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("strong",{parentName:"td"},(0,a.kt)("a",{parentName:"strong",href:"https://docs.espressif.com/projects/esp-idf/en/release-v5.1/esp32/index.html"},"v5.1")))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Device"),(0,a.kt)("td",{parentName:"tr",align:null},"ESP32-S3-WROOM-1")))),(0,a.kt)("p",null," ",(0,a.kt)("strong",{parentName:"p"},"\u521b\u5efa\u7a7a\u9879\u76ee")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6fc0\u6d3b\u73af\u5883")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},". ~/esp/esp-idf/export.sh \n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u521b\u5efa\u9879\u76ee")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"idf.py create-project ${project_name}\n")),(0,a.kt)("h3",{id:"event-bits--event-groups"},"Event bits / Event groups"),(0,a.kt)("p",null,"\u4e8b\u4ef6\u7ec4\u7531 ",(0,a.kt)("inlineCode",{parentName:"p"},"EventGroupHandle_t")," \u7c7b\u578b\u7684\u53d8\u91cf\u5f15\u7528\uff0c\u5b9a\u4e49\u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c"},"struct EventGroupDef_t;\ntypedef struct EventGroupDef_t   * EventGroupHandle_t;\n\xb7\xb7\xb7\ntypedef struct EventGroupDef_t\n{\n    EventBits_t uxEventBits;\n    List_t xTasksWaitingForBits; /*< List of tasks waiting for a bit to be set. */\n\n    #if ( configUSE_TRACE_FACILITY == 1 )\n        UBaseType_t uxEventGroupNumber;\n    #endif\n\n    #if ( ( configSUPPORT_STATIC_ALLOCATION == 1 ) && ( configSUPPORT_DYNAMIC_ALLOCATION == 1 ) )\n        uint8_t ucStaticallyAllocated; /*< Set to pdTRUE if the event group is statically allocated to ensure no attempt is made to free the memory. */\n    #endif\n\n    portMUX_TYPE xEventGroupLock; /* Spinlock required for SMP critical sections */\n} EventGroup_t;\n")),(0,a.kt)("p",null,"\u4e8b\u4ef6\u7ec4\u4e2d\u7684\u6240\u6709\u4e8b\u4ef6\u90fd\u5b58\u50a8\u5728 EventBits_t \u7c7b\u578b\u7684\u65e0\u7b26\u53f7\u6574\u5f62\u53d8\u91cf\u4e2d"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c"},"typedef uint32_t TickType_t;\n\xb7\xb7\xb7\ntypedef TickType_t               EventBits_t;\n")),(0,a.kt)("p",null,"\u53ef\u5982\u4e0b\u5b9a\u4e49"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c"},"#define FLAG_0 BIT0\n#define FLAG_1 BIT1\n#define FLAG_2 BIT2\n")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://pictures-1304295136.cos.ap-guangzhou.myqcloud.com/screenshot/esp32/demo-freetros-event-group/EventGroupDatatype.png",alt:null})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u524d\u4e09\u4e2a\u4e8b\u4ef6\u4f4d\u88ab\u7528\u6765\u63cf\u8ff0\u4e8b\u4ef6\uff0c\u4e8b\u4ef6\u4f4d 2 \u88ab\u8bbe\u7f6e")),(0,a.kt)("h3",{id:"api"},"API"),(0,a.kt)("h4",{id:"xeventgroupcreate"},(0,a.kt)("a",{parentName:"h4",href:"https://www.freertos.org/zh-cn-cmn-s/xEventGroupCreate.html"},"xEventGroupCreate()")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u521b\u5efa\u65b0\u4e8b\u4ef6\u7ec4")),(0,a.kt)("h4",{id:"xeventgroupwaitbits"},(0,a.kt)("a",{parentName:"h4",href:"https://www.freertos.org/zh-cn-cmn-s/xEventGroupWaitBits.html"},"xEventGroupWaitBits()")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8bfb\u53d6 RTOS \u4e8b\u4ef6\u7ec4\u4e2d\u7684\u4f4d\uff0c\u9009\u62e9\u6027\u5835\u585e\u4efb\u52a1")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c"},"EventBits_t xEventGroupWaitBits(\n                    const EventGroupHandle_t xEventGroup,\n                    const EventBits_t uxBitsToWaitFor,\n                    const BaseType_t xClearOnExit,\n                    const BaseType_t xWaitForAllBits,\n                    TickType_t xTicksToWait );\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"xEventGroup \u521b\u5efa\u597d\u7684\u4e8b\u4ef6\u7ec4"),(0,a.kt)("li",{parentName:"ul"},"uxBitsToWaitFor \u4e8b\u4ef6\u7ec4\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u8981\u7b49\u5f85\u7684\u4e8b\u4ef6\u4f4d"),(0,a.kt)("li",{parentName:"ul"},"xClearOnExit \u5982\u679c\u8bbe\u7f6e\u4e3a TRUE \u5e76\u4e14\u4e8b\u4ef6\u6ca1\u6709\u8d85\u65f6\uff0c\u5219\u4f1a\u5728\u8fd4\u56de\u503c\u4e4b\u524d\u6e05\u9664\u6389\u4e8b\u4ef6\u4f4d"),(0,a.kt)("li",{parentName:"ul"},"xWaitForAllBits \u4e3a TRUE \u5219 uxBitsToWaitFor \u4e2d\u6240\u4f20\u53c2\u6570\u5fc5\u987b\u90fd\u88ab\u8bbe\u7f6e\uff0c\u4e3a FALSE \u5219 uxBitsToWaitFor \u4efb\u4f55\u4f4d\u88ab\u8bbe\u7f6e\u5373\u53ef"),(0,a.kt)("li",{parentName:"ul"},"xTicksToWait \u7b49\u5f85\u7684\u6700\u5927\u65f6\u95f4\uff0c\u76f8\u5f53\u4e8e\u4efb\u52a1\u5835\u585e\u7684\u65f6\u95f4")),(0,a.kt)("admonition",{type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"\u65e0\u6cd5\u4ece\u4e2d\u65ad\u4e2d\u8c03\u7528")),(0,a.kt)("h4",{id:"xeventgroupsetbits"},(0,a.kt)("a",{parentName:"h4",href:"https://www.freertos.org/zh-cn-cmn-s/xEventGroupSetBits.html"},"xEventGroupSetBits()")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8bbe\u7f6e RTOS \u4e8b\u4ef6\u7ec4\u4e2d\u7684\u4f4d")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c"},"EventBits_t xEventGroupSetBits( EventGroupHandle_t xEventGroup,\n                                const EventBits_t uxBitsToSet );\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"xEventGroup \u521b\u5efa\u597d\u7684\u4e8b\u4ef6\u7ec4"),(0,a.kt)("li",{parentName:"ul"},"uxBitsToSet \u8981\u8bbe\u7f6e\u7684\u4e8b\u4ef6\u4f4d\u7684\u503c")),(0,a.kt)("admonition",{type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"\u65e0\u6cd5\u4ece\u4e2d\u65ad\u4e2d\u8c03\u7528")),(0,a.kt)("h2",{id:"\u793a\u4f8b\u4ee3\u7801"},"\u793a\u4f8b\u4ee3\u7801"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c"},'#include <stdio.h>\n#include "esp_log.h"\n#include "freertos/FreeRTOS.h"\n#include "freertos/task.h"\n#include "freertos/event_groups.h"\n\nstatic EventGroupHandle_t s_event_group;\n\n#define EVENT_FLAG BIT23\n\nvoid task_1(void *pt)\n{\n    ESP_LOGI("Task 1", "\u521b\u5efa\u5b8c\u6210");\n    while (1) {\n        ESP_LOGW("TASK_1", "Wait for Task 2 Set Bit");\n        xEventGroupWaitBits(s_event_group,\n                            EVENT_FLAG,\n                            pdTRUE,\n                            pdFALSE,\n                            portMAX_DELAY);\n        ESP_LOGW("TASK_1", "Done");\n    }\n}\n\nvoid task_2(void *pt)\n{\n    ESP_LOGI("TASK_2", "\u521b\u5efa\u5b8c\u6210");\n    while (1) {\n        ESP_LOGW("TASK_2", "Delay of 5 seconds");\n\n        vTaskDelay(5000 / portTICK_PERIOD_MS);\n        xEventGroupSetBits(s_event_group, EVENT_FLAG);\n    }\n}\n\nvoid task_3(void *pt)\n{\n    ESP_LOGI("Task 3", "\u521b\u5efa\u5b8c\u6210");\n    while (1) {\n        ESP_LOGI("TASK_3", "Keep Running");\n\n        vTaskDelay(1000 / portTICK_PERIOD_MS);\n    }\n}\n\nvoid app_main(void)\n{\n    s_event_group = xEventGroupCreate();\n\n    xTaskCreate(task_1, "task_1", 1024 * 12, NULL, 1, NULL);\n    xTaskCreate(task_2, "task_2", 1024 * 12, NULL, 1, NULL);\n    xTaskCreate(task_3, "task_3", 1024 * 12, NULL, 1, NULL);\n}\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd0\u884c\u7ed3\u679c")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://pictures-1304295136.cos.ap-guangzhou.myqcloud.com/screenshot/esp32/demo-freetros-event-group/EventGroupResult.png",alt:null})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"task_1 \u4e2d\u7684 xEventGroupWaitBits \u5c06\u4f1a\u5835\u585e\u4efb\u52a1\uff0c\u76f4\u81f3\u4efb\u52a1\u8d85\u65f6\uff0c\u6216\u8005 task_2 \u4e2d\u7684 xEventGroupSetBits \u8bbe\u7f6e\u4e8b\u4ef6\u4f4d\u540e\uff0c\u7ee7\u7eed\u6267\u884c"),(0,a.kt)("li",{parentName:"ul"},"task_3 \u4e0d\u88ab\u5f71\u54cd")),(0,a.kt)("h2",{id:"\u53c2\u8003"},"\u53c2\u8003"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("a",{parentName:"strong",href:"https://www.freertos.org/zh-cn-cmn-s/FreeRTOS-Event-Groups.html"},"freertos-\u4e8b\u4ef6\u4f4d\uff08\u6216\u6807\u5fd7\uff09\u548c\u4e8b\u4ef6\u7ec4"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("a",{parentName:"strong",href:"https://gist.github.com/lonelybinary/eab79c894ac021893107fbc407d55055"},"lonelybinary/bilibili_wifi_event_group.c")))))}k.isMDXComponent=!0}}]);